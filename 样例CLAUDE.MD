## 四阶段协作规范（含验收机制）

在开发任何功能时，请遵循以下四个阶段进行。每个阶段都有明确的目标和需要维护的文件。**每个阶段完成后，必须输出阶段总结并请求用户验收，只有用户明确确认后，才能进入下一阶段。**

### 1. 概念层：可行性调研
- **目标**：确定需求是否可行，识别技术难点和大致改动范围，**不修改实际代码**。
- **需要维护的文件**：
  - `plan.md`：创建或更新该文件，记录以下内容：
    - 需求描述
    - 技术难点分析
    - 可能的实现路径
    - 需要验证的核心假设
- **验收要求**：
  - 输出调研总结，列出关键发现和推荐的下一步计划。
  - **等待用户输入“确认”或明确同意后，方可进入骨架层。**

### 2. 骨架层：最小可行性验证
- **目标**：用最少的代码验证核心假设，确保关键路径能跑通，**允许代码粗糙**。
- **需要维护的文件**：
  - `plan.md`：更新以下内容：
    - 当前验证步骤
    - 遇到的问题及解决方案
    - 验证结果（成功/失败）
    - 下一步完善方向
  - **项目源码**：进行最小改动，实现可运行的原型（代码可以临时、不追求质量）。
- **验收要求**：
  - 输出验证结果报告，说明核心假设是否成立，并展示可运行的 demo 效果。
  - **等待用户手动测试并确认“验证通过”后，方可进入血肉层。**

### 3. 血肉层：完善与规范
- **目标**：基于已验证的骨架，按照项目规范完善代码（样式、封装、健壮性、注释、测试）。
- **需要维护的文件**：
  - `plan.md`：作为任务清单，逐项标记完成情况（例如用 `- [x]`）。
  - **项目源码**：进行重构、优化、添加注释，确保符合项目代码风格。
  - **测试文件**（如适用）：编写或更新单元测试/集成测试。
  - `package.json`（如适用）：添加新依赖或脚本。
  - `README.md`：如果功能影响使用方式，添加简要说明。
- **验收要求**：
  - 输出完善后的代码和测试结果（如测试通过）。
  - **等待用户审查代码并确认“符合要求”后，方可进入记忆固化层。**

### 4. 记忆固化：记录技术决策
- **目标**：将本次开发中确认的规则、技术选型、注意事项写入长期记忆，供未来参考。
- **需要维护的文件**：
  - `CLAUDE.md`：在文件中追加一段结构化记录，包括：
    - 功能名称与日期
    - 关键技术决策（如启动时机、封装方式、避免的坑）
    - 易错点与最佳实践
  - `plan.md`：如果已完成使命，可将其归档（例如移动到 `docs/archive/`）或保留并标记为“已完成”。
- **验收要求**：
  - 输出追加到 `CLAUDE.md` 的内容预览。
  - **等待用户确认记录准确无误后，整个功能开发流程结束。**

---

## 交互建议

在开始一个新功能时，请使用以下模板与 Claude Code 对话，以明确阶段和任务：
